<?xml version="1.0" encoding="UTF-8"?>
<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.0.xsd ">
	
	<!-- Start : Added for SSO Integration -->
	<beans:import resource="classpath:security/securityContext.xml"/>
	<beans:import resource="classpath:security/samlmetadata-context.xml"/> 
	<beans:import resource="classpath:opentestsystem.itemrenderer.xml" />
	
	<!-- End : Added for SSO Integration -->
	
	<!-- Root Context: defines shared resources visible to all other web components -->
	<context:property-placeholder
		local-override="true"
		location="classpath:settings.xml"
		ignore-unresolvable="true" order="900" />
		
	<context:property-placeholder
	    ignore-unresolvable="true"
	    ignore-resource-not-found="true"
	    order="110"
	    location="${testadmin-override-properties:file:///${user.home}/testadmin-settings.xml}"/>
		
	<import resource="classpath:opentestsystem.shared.common-context-module.xml" />
	<import resource="classpath:opentestsystem.shared.security-context-module.xml" />
	<import resource="classpath:opentestsystem.shared.db-context-module.xml"/>
	<import resource="classpath:opentestsystem.shared.tr-api-context-module.xml" />
				
	<!-- Root Context: defines shared resources visible to all other web components -->
	
	<context:annotation-config />
	
	<!-- DLLs -->
	<import resource="classpath:context-modules/dlls-context-module.xml"/>
	
	<!--  Repositories -->
	<import resource="classpath:context-modules/repositories-context-module.xml"/>
    
	<!-- Services -->
	<import resource="classpath:context-modules/services-context-module.xml"/>	
	
	<!-- database settings -->		
	<!-- <jee:jndi-lookup id="applicationDataSource"
		   jndi-name="${DBJndiName}"
		   expected-type="javax.sql.DataSource" /> -->

	<beans:bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
		<beans:property name="dataSourceClassName" value="com.mysql.jdbc.jdbc2.optional.MysqlDataSource" />
		<beans:property name="dataSourceProperties" >
			<beans:props>
				<beans:prop key="url">${datasource.url}</beans:prop>
				<beans:prop key="user">${datasource.username}</beans:prop>
				<beans:prop key="password">${datasource.password}</beans:prop>
			</beans:props>
		</beans:property>

		<beans:property name="poolName" value="ProctorHikariCP" />
		<beans:property name="maxLifetime" value="1800000" />
		<beans:property name="minimumIdle" value="${datasource.minPoolSize:5}" />
		<beans:property name="maximumPoolSize" value="${datasource.maxPoolSize:20}" />
		<beans:property name="leakDetectionThreshold" value="15000" />

		<!-- The follow values are the defaults -->
		<!--<beans:property name="autoCommit" value="true" />-->
		<!--<beans:property name="connectionTimeout" value="30000" />-->
		<!--<beans:property name="idleTimeout" value="30000" /> &lt;!&ndash; connect_timeout on MySQL is 60 seconds, and HikariCP recommends making this 30 seconds less than that value &ndash;&gt;-->
	</beans:bean>

	<beans:bean id="applicationDataSource" class="com.zaxxer.hikari.HikariDataSource">
		<beans:constructor-arg ref="hikariConfig" />
	</beans:bean>

	<!--&lt;!&ndash;Start: c3p0 Datasource Configuration &ndash;&gt;-->
	<!--<beans:bean id="applicationDataSource" destroy-method="close"-->
		  <!--class="com.mchange.v2.c3p0.ComboPooledDataSource" >-->
	    <!--<beans:property name="driverClass" value="${datasource.driverClassName:com.mysql.jdbc.Driver}"/>-->
	    <!--<beans:property name="jdbcUrl" value="${datasource.url:jdbc:mysql://tds-db.dev.opentestsystem.org:3306/session}"/>-->
	    <!--<beans:property name="user" value="${datasource.username:dbsbac}"/>-->
	    <!--<beans:property name="password" value="${datasource.password:osTyMhRM1C}"/>-->
	    <!--<beans:property name="minPoolSize" value="${datasource.minPoolSize:5}"/>-->
		<!--<beans:property name="acquireIncrement" value="${datasource.acquireIncrement:5}" />-->
		<!--<beans:property name="maxPoolSize" value="${datasource.maxPoolSize:20}" />-->
		<!--<beans:property name="checkoutTimeout" value="${datasource.checkoutTimeout:60000}" />-->
		<!--<beans:property name="preferredTestQuery" value="SELECT 1" />-->
		<!--<beans:property name="maxConnectionAge" value="${datasource.maxConnectionAge:0}"/>-->
		<!--<beans:property name="acquireRetryAttempts" value="${datasource.acquireRetryAttempts:5}"/>-->
		<!--<beans:property name="idleConnectionTestPeriod" value="${datasource.idleConnectionTestPeriod:300}"/>-->
		<!--<beans:property name="testConnectionOnCheckout" value="${datasource.testConnectionOnCheckout:false}"/>-->
		<!--<beans:property name="testConnectionOnCheckin" value="${datasource.testConnectionOnCheckin:false}"/>-->
		<!--<beans:property name="numHelperThreads" value="${datasource.numHelperThreads:6}"/>-->
		<!--<beans:property name="maxStatements" value="${datasource.maxStatements:20000}"/>-->
		<!--<beans:property name="maxStatementsPerConnection" value="${datasource.maxStatementsPerConnection:200}"/>-->
	<!--</beans:bean>-->
	<!--End: c3p0 Datasource Configuration -->

	<!--SB-1040: Added for fileFtpHandler bean -->
	<beans:import resource="classpath:opentestsystem.shared.web-context-module.xml" />
	
</beans>
